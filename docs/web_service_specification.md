# 서비스 기획서 (Service Specification)

> 주식 초보자(주린이)를 위해 챗봇의 접근성과 웹의 시각적 정보를 결합하여,
> 쉽고 직관적인 투자 정보를 제공

**타겟 디바이스:** Mobile Web (카카오톡 인앱 브라우저 최적화)

---

## 서비스 개요

| 항목 | 내용 |
|------|------|
| 프로젝트 목적 | 카카오톡 챗봇을 중심으로 주식 정보를 제공하고, 차트·리포트 등 복잡한 UI는 웹에서 제공 |
| 주요 타겟 | 주식을 잘 모르는 초보 사용자 및 주식 보유자 |
| 핵심 전략 | 챗봇 = 진입·요약 / 웹 = 상세·시각화(차트) |
| Web의 역할 | 차트 제공, 상세 리포트 제공, 투자 요약 제공, 반응 요약 제공 |
| 진입 방식 | 카카오톡 챗봇 webLink 버튼 (임시로 지정) |

---

## 기능명세서

---

# Web_01. 종목 차트 페이지

## 0. 전제/정책

- Web_01 종목 차트는 **계좌 연동 없이 사용 가능**
- 계좌 미연동 제한 기능: 거래내역/상세/요약/물타기 → Web_03~04에서 잠금 처리

---

## 1. 서비스 전달 방법

- 서버에서 Plotly HTML/JSON을 만들어 프론트에 전달
  - 백엔드: `fig.to_json()`
  - 프론트는 Plotly.js로 그대로 렌더링

---

## 2. 화면 요구사항

### 2-1. 기간 탭 (고정)

| 탭 | 설명 |
|----|------|
| 하루 | 일중 차트 (5분봉) |
| 1달 | 일봉 30일 |
| 3달 | 일봉 90일 |
| 1년 | 일봉 365일 |

- 탭 변경 시 즉시 로딩 표시 → 차트 갱신

### 2-2. 차트 기본 타입

| 구분 | 내용 |
|------|------|
| 기본 화면 | 캔들스틱 + MA(5, 20, 60) |
| 보조 기능 (고도화) | 기술적(볼린저+RSI), 거래량, 라인(가격 추이) |

---

## 3. 데이터 준비사항

### 3-1. 기간 파라미터 매핑

| 웹 Range | days 매핑 | 차트 타입 | 비고 |
|----------|-----------|-----------|------|
| 하루 (1d) | - | 5분봉 | 별도 분봉 API 필요 |
| 1달 (1m) | 30 | 일봉 | |
| 3달 (3m) | 90 | 일봉 | |
| 1년 (1y) | 365 | 일봉 | |

### 3-2. 서버 전달 포맷

```json
{
  "symbol": "005930",
  "range": "3m",
  "type": "candlestick",
  "plotly": { "fig.to_json() 결과" },
  "meta": {
    "ma": [5, 20, 60],
    "generatedAt": "ISO8601"
  }
}
```

---

## 4. API 명세

### 4-1. 공통 규칙

- `symbol` (종목코드): 필수
- `range`: 필수 (`1d` | `1m` | `3m` | `1y`)
- `type`: 선택 (`candlestick` | `technical` | `line` | `volume`)

### 4-2. 엔드포인트

```
GET /api/web/stocks/{symbol}/chart
```

**Query Parameters:**
| 파라미터 | 필수 | 기본값 | 설명 |
|----------|------|--------|------|
| range | ✅ | - | `1d`, `1m`, `3m`, `1y` |
| type | ❌ | `candlestick` | 차트 타입 |

**Response:**
```json
{
  "symbol": "005930",
  "range": "3m",
  "type": "candlestick",
  "plotly": { "..." },
  "meta": {
    "ma": [5, 20, 60],
    "generatedAt": "2026-01-24T10:30:00"
  }
}
```

**에러 응답:**
```json
{
  "plotly": null,
  "meta": {
    "reason": "NO_DATA"
  }
}
```

### 4-3. 캐싱 정책

| Range | TTL | 비고 |
|-------|-----|------|
| 1d | 10~60초 | 일중 실시간 |
| 1m | 5분 | |
| 3m | 15분 | |
| 1y | 30분 | |

---

## 5. 프론트엔드 준비사항

### 5-1. 컴포넌트 구조

| 컴포넌트 | 역할 |
|----------|------|
| `ChartHeader` | 종목명/현재가/등락 표시 |
| `RangeTabs` | 하루/1달/3달/1년 탭 |
| `ChartRenderer` | Plotly 렌더 영역 |
| `ChartTypeToggle` | 캔들/라인/기술적/거래량 (선택) |

### 5-2. 동작 흐름

1. **최초 진입**: `range=1m`, `type=candlestick` 호출
2. **탭 클릭**: 로딩 스켈레톤 → API 재호출 → plotly 렌더 교체
3. **실패 시**: 재시도 버튼 + 빈 상태 UI

### 5-3. Plotly 렌더 방식

- `plotly.js` 또는 `react-plotly.js` 사용
- 반응형 크기(모바일) 대응: 컨테이너 width 변화에 리사이즈

---

## 6. 기능 단위 명세

| ID | 기능 | 담당 | 설명 |
|----|------|------|------|
| Web_01-1 | 차트 기간 탭 | FE | 4개 탭 컴포넌트, 탭 변경 시 API 재호출 |
| Web_01-2 | 차트 렌더러 | FE | Plotly JSON 렌더링, 로딩/에러/빈 상태 처리 |
| Web_01-3 | 차트 API | BE | range→days 매핑, fig 생성→json 반환 |
| Web_01-4 | 캐시/성능 | BE | TTL 캐싱, 동일 요청 중복 방지 |

---

## 7. 종목 탐색 메인 화면

### 7-1. 화면 구성

```
┌─────────────────────────────────────────────────────────────────┐
│  [검색창]                                                        │
│  [전체] [관심 종목] [보유 종목]                                   │
├─────────────────────────────┬───────────────────────────────────┤
│                             │                                   │
│    종목 리스트 영역          │      선택 종목 차트 영역           │
│    (와이어프레임 1번)        │      (와이어프레임 2번)            │
│                             │                                   │
└─────────────────────────────┴───────────────────────────────────┘
```

### 7-2. 와이어프레임 1번 - 종목 리스트 영역

#### 상단 검색 영역

| 요소 | 설명 |
|------|------|
| 검색 입력창 | 주식 종목 검색 |
| 탭 버튼 | 전체 / 관심 종목 / 보유 종목 |

- 검색 입력 시 → 종목 상세 페이지로 즉시 이동
- 검색 X 상태에서만 종목 리스트 영역 유지

#### 종목 리스트 (기본 상태)

| 표시 정보 | 설명 |
|-----------|------|
| 종목명 | 회사 이름 |
| 현재가 | 현재 주가 |
| 등락률 | 전일 대비 % |

- 기본 탭: 전체
- 기본 정렬: 주가순

#### 탭별 정렬 옵션

| 탭 | 정렬 옵션 |
|----|-----------|
| 전체 | 주가순(기본), 상승률순, 거래량순 |
| 관심 종목 | 최근 추가순(기본), 등락률순, 종목명순 |
| 보유 종목 | 평가금액순(기본), 수익률순, 보유수량순, 종목명순 |

- **보유 종목 탭 조건**: 계좌 미연동 시 "계좌 연동 필요" 안내 표시

### 7-3. 와이어프레임 2번 - 선택 종목 차트 영역

#### 기본 차트 표시

| 요소 | 설명 |
|------|------|
| 차트 | 선택 종목의 차트 |
| 주기 버튼 | 하루 / 1달 / 3달 / 1년 |

- 기본 주기: 하루
- 기본 차트 타입: 캔들스틱 + MA(5, 20, 60)

#### 주기별 데이터 기준

| 주기 | 데이터 |
|------|--------|
| 하루 | 일중 차트 (5분봉) |
| 1달 | 일봉 |
| 3달 | 일봉 |
| 1년 | 일봉 |

#### 차트 갱신 조건

| 갱신됨 | 갱신 안됨 |
|--------|-----------|
| 종목 리스트에서 종목 선택 시 | 탭 전환만 수행 (종목 선택 없음) |
| 차트 주기 변경 시 | |

---

# (2) 종목 상세 리포트 페이지

**목적:** 챗봇 요약을 확장한 '읽기 쉬운 투자 리포트' 제공

| 영역 | 구성 요소 | 데이터 |
|------|-----------|--------|
| 상단 요약 | 한 줄 요약 | kakao.summary.brief_summary |
| 투자 의견 | 목표가 / 리스크 | investment_opinion |
| section Tab | 요약 / 주가 / 재무 / 의견 | sections.* |
| 원문 보기 | 전체 리포트 | report.full_text |
| 근거 데이터 | 지표 / 추이 카드 | raw_data.* |

---

# (3) 투자 내역 한눈 요약 페이지

**목적:** 초보자도 이해 가능한 월간 투자 요약 제공

| 영역 | 구성 요소 |
|------|-----------|
| 월간 요약 | 총 수익률, 손익 |
| 종목 요약 | 종목별 수익률 |
| 설명 블록 | 용어 설명 |

---

# Web_02. 뉴스/커뮤니티 탭

## 0. 전제/정책

- Web_02는 종목 상세 페이지 최하단 (블록 5)에 위치
- **계좌 연동 없이 사용 가능**
- 기본 탭: 커뮤니티

---

## 1. 화면 요구사항

### 1-1. 탭 구성

| 탭 | 설명 | 기본값 |
|----|------|--------|
| 커뮤니티 | 시장 반응/투자자 의견 | ✅ (기본) |
| 뉴스 | 투자 관련 뉴스 (필터링) | |

### 1-2. 커뮤니티 탭

| 요소 | 설명 |
|------|------|
| AI 요약 | 상단에 시장 반응 요약 표시 |
| 피드 리스트 | 제목, 내용 미리보기, 출처, 감성(긍정/중립/부정) |
| 무한 스크롤 | 페이지네이션 대신 무한 스크롤 적용 |
| 새 글 배너 | "새 글 N개" 배너 (실시간 폴링) |

### 1-3. 뉴스 탭

| 요소 | 설명 |
|------|------|
| 뉴스 리스트 | 제목, 내용 미리보기, 출처, 게시일 |
| 필터링 | 투자 관련 뉴스만 표시 (2단계 필터링) |
| 무한 스크롤 | 페이지네이션 대신 무한 스크롤 적용 |

---

## 2. 필터링 로직 (뉴스 탭)

### 2-1. 2단계 필터링

| 단계 | 방식 | 설명 |
|------|------|------|
| 1단계 | 키워드 필터 | 투자 관련 키워드 포함 여부 확인 |
| 2단계 | LLM 분류 | AI로 투자 판단 도움 여부 분류 (선택) |

### 2-2. 투자 관련 키워드

```
주가, 주식, 투자, 매수, 매도, 목표가, 실적,
영업이익, 매출, 배당, 공시, IR, 애널리스트,
증권, 펀드, ETF, 상승, 하락, 전망
```

---

## 3. API 명세

### 3-1. 뉴스 API

```
GET /api/web/stocks/{symbol}/news
```

**Query Parameters:**
| 파라미터 | 필수 | 기본값 | 설명 |
|----------|------|--------|------|
| page | ❌ | 1 | 페이지 번호 |
| limit | ❌ | 10 | 페이지당 개수 |

**Response:**
```json
{
  "symbol": "005930",
  "company_name": "삼성전자",
  "tab": "news",
  "page": 1,
  "limit": 10,
  "total_count": 15,
  "has_more": true,
  "items": [
    {
      "id": "news_1",
      "title": "삼성전자, HBM4 점유율 2배 확대 전망",
      "content": "KB증권은 삼성전자 목표주가를...",
      "url": "https://...",
      "source": "비즈니스포스트",
      "published_at": "2026-01-24 10:30:00",
      "is_investment_related": true
    }
  ],
  "fetched_at": "2026-01-24T10:30:00"
}
```

### 3-2. 커뮤니티 API

```
GET /api/web/stocks/{symbol}/community
```

**Query Parameters:**
| 파라미터 | 필수 | 기본값 | 설명 |
|----------|------|--------|------|
| page | ❌ | 1 | 페이지 번호 |
| limit | ❌ | 10 | 페이지당 개수 |
| last_id | ❌ | - | 마지막 조회 ID (새 글 확인용) |

**Response:**
```json
{
  "symbol": "005930",
  "company_name": "삼성전자",
  "tab": "community",
  "page": 1,
  "limit": 10,
  "total_count": 20,
  "has_more": true,
  "ai_summary": "애널리스트들은 삼성전자 HBM4 경쟁력에 긍정적...",
  "items": [
    {
      "id": "comm_1",
      "title": "KB증권 삼성전자 목표주가 20만원 유지",
      "content": "김동원 KB증권 연구원은...",
      "url": "https://...",
      "source": "비즈니스포스트",
      "sentiment": "positive",
      "published_at": "2026-01-24 10:30:00"
    }
  ],
  "fetched_at": "2026-01-24T10:30:00",
  "new_count": 0
}
```

**에러 응답:**
```json
{
  "error": "에러 메시지",
  "items": [],
  "fetched_at": "2026-01-24T10:30:00"
}
```

---

## 4. 프론트엔드 준비사항

### 4-1. 컴포넌트 구조

| 컴포넌트 | 역할 |
|----------|------|
| `NewsCommunityTabs` | 커뮤니티/뉴스 탭 전환 |
| `CommunityFeed` | 커뮤니티 피드 렌더링 |
| `NewsFeed` | 뉴스 피드 렌더링 |
| `FeedItem` | 개별 피드 아이템 |
| `NewBanner` | "새 글 N개" 배너 |
| `AISummary` | AI 요약 카드 |

### 4-2. 동작 흐름

1. **최초 진입**: `tab=community`, `page=1` 호출
2. **탭 클릭**: 로딩 스켈레톤 → API 재호출 → 피드 교체
3. **무한 스크롤**: `has_more=true`면 다음 페이지 호출
4. **실시간 폴링**: 5-10초 간격으로 새 글 확인 (커뮤니티 탭)
5. **실패 시**: 재시도 버튼 + 빈 상태 UI

### 4-3. 감성 표시 (커뮤니티)

| sentiment | 표시 |
|-----------|------|
| positive | 🟢 긍정 |
| neutral | ⚪ 중립 |
| negative | 🔴 부정 |

---

## 5. 기능 단위 명세

| ID | 기능 | 담당 | 설명 |
|----|------|------|------|
| Web_02-1 | 탭 전환 | FE | 커뮤니티/뉴스 탭 컴포넌트 |
| Web_02-2 | 무한 스크롤 | FE | 페이지네이션 없이 스크롤 로딩 |
| Web_02-3 | 새 글 배너 | FE | 실시간 폴링 + 배너 표시 |
| Web_02-4 | 뉴스 API | BE | 2단계 필터링 적용 |
| Web_02-5 | 커뮤니티 API | BE | AI 요약 + 감성 분석 |

---

## 6. 캐싱 정책

| 탭 | TTL | 비고 |
|----|-----|------|
| 커뮤니티 | 30초~1분 | 실시간성 필요 |
| 뉴스 | 5분 | 상대적으로 느린 갱신 |

---

## 데이터 연동 구조

```
┌─────────────────────────────────────────────────────────────────┐
│  카카오톡 챗봇                                                   │
│  ├─ 간단한 질문/응답                                            │
│  ├─ 요약 정보 제공                                              │
│  └─ webLink 버튼 → 웹 페이지 연결                               │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│  Mobile Web (카카오톡 인앱 브라우저)                             │
│  ├─ (1) 종목 차트 페이지                                        │
│  ├─ (2) 종목 상세 리포트 페이지                                 │
│  ├─ (3) 투자 내역 요약 페이지                                   │
│  └─ (4) 뉴스/커뮤니티 반응 요약 페이지                          │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│  Backend API                                                     │
│  ├─ 한국투자증권 API (시세, 거래내역)                            │
│  ├─ Tavily API (뉴스 검색)                                      │
│  └─ Gemini API (AI 분석/요약)                                   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 참고사항

- 웹 페이지는 카카오톡 인앱 브라우저에서 최적화되어야 함
- 초보자 타겟이므로 용어 설명 및 직관적 UI 필수
- 차트는 Plotly.js로 렌더링 (백엔드에서 fig.to_json() 전달)
